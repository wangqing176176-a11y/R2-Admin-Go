(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,75254,e=>{"use strict";var r=e.i(71645);let t=(...e)=>e.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim(),a=e=>{let r=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase());return r.charAt(0).toUpperCase()+r.slice(1)};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)(({color:e="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:i="",children:n,iconNode:o,...c},x)=>(0,r.createElement)("svg",{ref:x,...s,width:a,height:a,stroke:e,strokeWidth:d?24*Number(l)/Number(a):l,className:t("lucide",i),...!n&&!(e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0;return!1})(c)&&{"aria-hidden":"true"},...c},[...o.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(n)?n:[n]])),d=(e,s)=>{let d=(0,r.forwardRef)(({className:d,...i},n)=>(0,r.createElement)(l,{ref:n,iconNode:s,className:t(`lucide-${a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,d),...i}));return d.displayName=a(e),d};e.s(["default",()=>d],75254)},40160,e=>{"use strict";let r=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>r],40160)},27025,e=>{"use strict";let r=(0,e.i(75254).default)("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);e.s(["Folder",()=>r],27025)},75505,e=>{"use strict";let r=(0,e.i(75254).default)("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);e.s(["FolderOpen",()=>r],75505)},58524,e=>{"use strict";let r=(0,e.i(75254).default)("link-2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);e.s(["Link2",()=>r],58524)},16715,e=>{"use strict";let r=(0,e.i(75254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>r],16715)},4818,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(40160),s=e.i(27025),l=e.i(75505),d=e.i(58524);let i=(0,e.i(75254).default)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var n=e.i(16715);let o=e=>{if(!Number.isFinite(e??NaN)||(e??0)<0)return"-";if(!e)return"0 B";let r=["B","KB","MB","GB","TB"],t=Math.min(r.length-1,Math.max(0,Math.floor(Math.log(e)/Math.log(1024))));return`${(e/1024**t).toFixed(2).replace(/\.00$/,"")} ${r[t]}`};function c({params:e}){let[c,x]=(0,t.useState)(""),[u,h]=(0,t.useState)(!0),[m,p]=(0,t.useState)(""),[g,y]=(0,t.useState)(null),[b,f]=(0,t.useState)(""),[k,w]=(0,t.useState)(""),[v,j]=(0,t.useState)(!1),[N,C]=(0,t.useState)(""),[S,M]=(0,t.useState)([]),[E,T]=(0,t.useState)(null),[$,A]=(0,t.useState)(!1),[L,R]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let r=!1;return(async()=>{let t=await e;r||x(String(t.code??"").trim())})(),()=>{r=!0}},[e]);let B=async e=>{try{return await e.json()}catch{return{}}},P=async e=>{h(!0),p("");try{let r=await fetch(`/api/share/public/meta?code=${encodeURIComponent(e)}`),t=await B(r);if(!r.ok||!t.meta)throw Error(String(t.error??"分享不存在或已失效"));y(t.meta)}catch(e){p((e instanceof Error?e.message:String(e))||"读取分享信息失败"),y(null)}finally{h(!1)}},H=async(e,r="")=>{j(!0),p("");try{let t=await fetch("/api/share/public/unlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,passcode:r})}),a=await B(t);if(!t.ok||!a.accessToken)throw Error(String(a.error??"提取码错误，请重试。"));return f(String(a.accessToken)),a.meta&&y(a.meta),String(a.accessToken)}catch(e){return p((e instanceof Error?e.message:String(e))||"校验提取码失败"),""}finally{j(!1)}},O=async e=>{if(!g||"folder"!==g.itemType||!b)return;let r=!!e?.append,t=e?.nextCursor??(r?E:null),a=e?.nextPath??N;r?R(!0):A(!0);try{let e=new URLSearchParams({code:g.shareCode,token:b,path:a});t&&e.set("cursor",t);let s=await fetch(`/api/share/public/list?${e.toString()}`),l=await B(s);if(!s.ok)throw Error(String(l.error??"读取文件夹失败"));let d=Array.isArray(l.items)?l.items:[];C(String(l.path??a)),T(l.cursor?String(l.cursor):null),M(e=>r?[...e,...d]:d)}catch(e){p((e instanceof Error?e.message:String(e))||"读取文件夹失败")}finally{r?R(!1):A(!1)}};(0,t.useEffect)(()=>{c&&P(c)},[c]),(0,t.useEffect)(()=>{g&&c&&"active"===g.status&&(g.passcodeEnabled||H(c,""))},[g,c]),(0,t.useEffect)(()=>{g&&"folder"===g.itemType&&b&&O({append:!1,nextPath:"",nextCursor:null})},[g,b]);let U=(0,t.useMemo)(()=>g?"expired"===g.status?"该分享已过期":"stopped"===g.status?"该分享已停止":"分享可用":"",[g]),F=(0,t.useMemo)(()=>N.split("/").filter(Boolean),[N]),D=e=>{if(!g||!b)return;let r=new URLSearchParams({code:g.shareCode,token:b});e&&r.set("key",e),window.location.href=`/api/share/public/download?${r.toString()}`};return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 via-sky-50 to-white dark:from-gray-950 dark:via-gray-900 dark:to-gray-900",children:(0,r.jsx)("div",{className:"mx-auto w-full max-w-4xl px-4 py-8 md:py-12",children:(0,r.jsxs)("div",{className:"rounded-2xl border border-blue-100 bg-white shadow-sm dark:border-blue-900/40 dark:bg-gray-900",children:[(0,r.jsxs)("div",{className:"border-b border-blue-100 px-5 py-4 md:px-7 dark:border-blue-900/40",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-blue-600 dark:text-blue-300",children:[(0,r.jsx)(d.Link2,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm font-semibold",children:"文件分享"})]}),(0,r.jsx)("h1",{className:"mt-2 text-xl font-bold text-gray-900 dark:text-gray-100",children:g?.itemName||"加载中..."}),(0,r.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"rounded-full border border-gray-200 px-2 py-0.5 dark:border-gray-700",children:g?.itemType==="folder"?"文件夹分享":"文件分享"}),g?.expiresAt?(0,r.jsxs)("span",{children:["有效期至：",new Date(g.expiresAt).toLocaleString()]}):(0,r.jsx)("span",{children:"永久有效"}),U?(0,r.jsxs)("span",{children:["状态：",U]}):null]})]}),(0,r.jsxs)("div",{className:"px-5 py-5 md:px-7 md:py-6",children:[u?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[(0,r.jsx)(n.RefreshCw,{className:"h-4 w-4 animate-spin"})," 正在加载分享信息..."]}):m?(0,r.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-900 dark:bg-red-950/30 dark:text-red-200",children:m}):null,g&&"active"===g.status&&g.passcodeEnabled&&!b?(0,r.jsxs)("div",{className:"rounded-xl border border-blue-200 bg-blue-50 px-4 py-4 dark:border-blue-900 dark:bg-blue-950/30",children:[(0,r.jsxs)("div",{className:"mb-3 flex items-center gap-2 text-sm font-medium text-blue-700 dark:text-blue-200",children:[(0,r.jsx)(i,{className:"h-4 w-4"})," 请输入提取码"]}),(0,r.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[(0,r.jsx)("input",{value:k,onChange:e=>w(e.target.value),placeholder:"输入提取码",className:"w-full rounded-lg border border-blue-200 bg-white px-3 py-2 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 dark:border-blue-900 dark:bg-gray-900 dark:text-gray-100"}),(0,r.jsxs)("button",{type:"button",onClick:()=>{H(g.shareCode,k.trim())},disabled:v,className:"inline-flex items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50",children:[v?(0,r.jsx)(n.RefreshCw,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(i,{className:"h-4 w-4"}),"验证提取码"]})]})]}):null,g&&"active"===g.status&&b&&"file"===g.itemType?(0,r.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-4 dark:border-gray-800 dark:bg-gray-950/30",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["文件大小：",o(g.size)]}),(0,r.jsxs)("button",{type:"button",onClick:()=>D(),className:"mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:[(0,r.jsx)(a.Download,{className:"h-4 w-4"})," 下载文件"]})]}):null,g&&"active"===g.status&&b&&"folder"===g.itemType?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[(0,r.jsx)("button",{type:"button",className:"rounded-md border border-gray-200 bg-white px-2 py-1 hover:bg-gray-50 dark:border-gray-800 dark:bg-gray-900 dark:hover:bg-gray-800",onClick:()=>{O({append:!1,nextPath:"",nextCursor:null})},children:"根目录"}),F.map((e,t)=>{let a=`${F.slice(0,t+1).join("/")}/`;return(0,r.jsx)("button",{type:"button",className:"rounded-md border border-gray-200 bg-white px-2 py-1 hover:bg-gray-50 dark:border-gray-800 dark:bg-gray-900 dark:hover:bg-gray-800",onClick:()=>{O({append:!1,nextPath:a,nextCursor:null})},children:e},`${e}-${t}`)})]}),(0,r.jsxs)("div",{className:"overflow-hidden rounded-xl border border-gray-200 dark:border-gray-800",children:[(0,r.jsx)("div",{className:"border-b border-gray-100 bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:border-gray-800 dark:bg-gray-950/40 dark:text-gray-400",children:"文件夹内容（仅支持逐个文件下载）"}),(0,r.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:$?(0,r.jsx)("div",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-400",children:"正在加载目录..."}):0===S.length?(0,r.jsx)("div",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-400",children:"当前目录为空"}):S.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 px-4 py-3",children:["folder"===e.type?(0,r.jsx)(s.Folder,{className:"h-4 w-4 text-yellow-500"}):(0,r.jsx)(a.Download,{className:"h-4 w-4 text-blue-600 dark:text-blue-300"}),(0,r.jsxs)("div",{className:"min-w-0 flex-1 text-sm text-gray-800 dark:text-gray-100",children:[(0,r.jsx)("div",{className:"truncate",children:e.name}),"file"===e.type?(0,r.jsx)("div",{className:"mt-0.5 text-xs text-gray-500 dark:text-gray-400",children:o(e.size)}):null]}),"folder"===e.type?(0,r.jsxs)("button",{type:"button",onClick:()=>{O({append:!1,nextPath:e.path,nextCursor:null})},className:"inline-flex items-center gap-1 rounded-md border border-gray-200 px-2 py-1 text-xs text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-800",children:[(0,r.jsx)(l.FolderOpen,{className:"h-3.5 w-3.5"})," 打开"]}):(0,r.jsxs)("button",{type:"button",onClick:()=>D(e.key),className:"inline-flex items-center gap-1 rounded-md bg-blue-600 px-2 py-1 text-xs text-white hover:bg-blue-700",children:[(0,r.jsx)(a.Download,{className:"h-3.5 w-3.5"})," 下载"]})]},`${e.type}-${e.key}`))})]}),E?(0,r.jsxs)("button",{type:"button",onClick:()=>{O({append:!0,nextCursor:E})},disabled:L,className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200 dark:hover:bg-gray-800",children:[L?(0,r.jsx)(n.RefreshCw,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(n.RefreshCw,{className:"h-4 w-4"}),"加载更多"]}):null]}):null]})]})})})}e.s(["default",()=>c],4818)}]);