(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["chunks/_8f0f0429._.js",92174,83642,e=>{"use strict";e.s(["fromUtf8",0,e=>new TextEncoder().encode(e)],92174),e.s(["toUtf8",0,e=>{if("string"==typeof e)return e;if("object"!=typeof e||"number"!=typeof e.byteOffset||"number"!=typeof e.byteLength)throw Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)}],83642)},84256,e=>{"use strict";async function t(){return"_ENTRIES"in globalThis&&_ENTRIES.middleware_instrumentation&&await _ENTRIES.middleware_instrumentation}let r=null;async function a(){if("phase-production-build"===process.env.NEXT_PHASE)return;r||(r=t());let e=await r;if(null==e?void 0:e.register)try{await e.register()}catch(e){throw e.message=`An error occurred while loading instrumentation hook: ${e.message}`,e}}async function n(...e){let r=await t();try{var a;await (null==r||null==(a=r.onRequestError)?void 0:a.call(r,...e))}catch(e){console.error("Error in instrumentation.onRequestError:",e)}}let i=null;function s(){return i||(i=a()),i}function o(e){return`The edge runtime does not support Node.js '${e}' module.
Learn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`}process!==e.g.process&&(process.env=e.g.process.env,e.g.process=process);try{Object.defineProperty(globalThis,"__import_unsupported",{value:function(e){let t=new Proxy(function(){},{get(t,r){if("then"===r)return{};throw Object.defineProperty(Error(o(e)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})},construct(){throw Object.defineProperty(Error(o(e)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})},apply(r,a,n){if("function"==typeof n[0])return n[0](t);throw Object.defineProperty(Error(o(e)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}});return new Proxy({},{get:()=>t})},enumerable:!1,configurable:!1})}catch{}s(),e.s(["edgeInstrumentationOnRequestError",()=>n,"ensureInstrumentationRegistered",()=>s,"getEdgeInstrumentationModule",()=>t])},1164,4648,e=>{"use strict";var t=e.i(51615),r=e.i(84442);let a=new TextEncoder,n=new TextDecoder,i=e=>(e=>{if(void 0!==t.Buffer)return t.Buffer.from(e).toString("base64");let r="";for(let t of e)r+=String.fromCharCode(t);return btoa(r)})(e).replaceAll("+","-").replaceAll("/","_").replaceAll("=",""),s=e=>{let r=e.replaceAll("-","+").replaceAll("_","/");var a=r+"=".repeat((4-(r.length%4||4))%4);if(void 0!==t.Buffer)return new Uint8Array(t.Buffer.from(a,"base64"));let n=atob(a),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return i},o=async(e,t)=>{let r=await crypto.subtle.digest("SHA-256",a.encode(`${t}:${e}`));return await crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"])},l=async(e,t,r)=>{let n=await o(e,t),s=crypto.getRandomValues(new Uint8Array(12)),l=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},n,a.encode(r));return`v1.${i(s)}.${i(new Uint8Array(l))}`},u=async(e,t,r)=>{let[a,i,l]=r.split(".",3);if("v1"!==a||!i||!l)throw Error("密文格式无效");let u=await o(e,t),c=s(i),d=s(l);try{let e=await crypto.subtle.decrypt({name:"AES-GCM",iv:c},u,d);return n.decode(new Uint8Array(e))}catch{throw Error("密钥解密失败：请检查 CREDENTIALS_ENCRYPTION_KEY 是否与历史配置一致。")}},c=()=>(0,r.requireEnvString)("CREDENTIALS_ENCRYPTION_KEY"),d=()=>{let e=(0,r.getEnvString)("ROUTE_TOKEN_SECRET","ACCESS_TOKEN_SECRET","CREDENTIALS_ENCRYPTION_KEY");if(!e)throw Error("缺少环境变量：ROUTE_TOKEN_SECRET 或 CREDENTIALS_ENCRYPTION_KEY");return e},p=async e=>await l(c(),"bucket-credential",e),f=async e=>e?e.startsWith("v1.")?await u(c(),"bucket-credential",e):e:"",m=async(e,t=900)=>{let r=JSON.stringify({exp:Math.floor(Date.now()/1e3)+Math.max(30,Math.min(86400,t)),payload:e});return await l(d(),"route-token",r)},h=async e=>{let t=JSON.parse(await u(d(),"route-token",e)),r=Number(t.exp??NaN);if(!Number.isFinite(r)||r<Math.floor(Date.now()/1e3))throw Error("操作令牌已过期，请重试。");return t.payload};e.s(["decryptCredential",0,f,"encryptCredential",0,p,"issueSealedPayload",0,m,"readSealedPayload",0,h],4648);var b=e.i(51959);let _="id,user_id,bucket_label,bucket_name,account_id,access_key_id_enc,secret_access_key_enc,public_base_url,custom_base_url,transfer_mode_override,is_default,created_at,updated_at",y=e=>{let t=String(e??"").trim();if(!t)return;let r=/^https?:\/\//i.test(t)?t:`https://${t}`;return r.endsWith("/")?r:`${r}/`},w=e=>String(e??"").trim(),g=e=>String(e??"").trim(),E=e=>({id:e.id,Name:e.bucket_label||e.bucket_name,CreationDate:e.created_at,transferMode:"presigned",bucketLabel:e.bucket_label||e.bucket_name,bucketName:e.bucket_name,accountId:e.account_id,isDefault:!!e.is_default,publicBaseUrl:y(e.public_base_url),customBaseUrl:y(e.custom_base_url)}),v=async(e,t,r)=>{let a=await (0,b.supabaseRestFetch)(e,{token:t,method:"GET"});return await (0,b.readSupabaseRestArray)(a,r)},R=async(e,t)=>{if(await (0,b.supabaseRestFetch)("user_r2_buckets?is_default=eq.true",{token:e,method:"PATCH",body:{is_default:!1}}),!(await (0,b.supabaseRestFetch)(`user_r2_buckets?id=eq.${encodeURIComponent(t)}`,{token:e,method:"PATCH",body:{is_default:!0},prefer:"return=minimal"})).ok)throw Error("设置默认存储桶失败")},S=async e=>{if((await v("user_r2_buckets?select=id&is_default=eq.true&limit=1",e,"读取默认存储桶失败")).length>0)return;let t=await v("user_r2_buckets?select=id&order=created_at.asc&limit=1",e,"读取存储桶列表失败");t[0]?.id&&await R(e,String(t[0].id))},C=async e=>(await v(`user_r2_buckets?select=${_}&order=is_default.desc,created_at.asc`,e,"读取存储桶列表失败")).map(E),k=async(e,t)=>{let r=(await v(`user_r2_buckets?select=${_}&id=eq.${encodeURIComponent(t)}&limit=1`,e,"读取存储桶信息失败"))[0];if(!r)throw Error("未找到存储桶");return{id:r.id,userId:r.user_id,bucketLabel:r.bucket_label||r.bucket_name,bucketName:r.bucket_name,accountId:r.account_id,accessKeyId:await f(r.access_key_id_enc),secretAccessKey:await f(r.secret_access_key_enc),publicBaseUrl:y(r.public_base_url),customBaseUrl:y(r.custom_base_url),transferModeOverride:"auto"===r.transfer_mode_override||"presigned"===r.transfer_mode_override||"proxy"===r.transfer_mode_override?r.transfer_mode_override:void 0,isDefault:!!r.is_default,createdAt:r.created_at,updatedAt:r.updated_at}},T=async(e,t)=>{let r=await k(e,t);return{detail:r,creds:{accountId:r.accountId,accessKeyId:r.accessKeyId,secretAccessKey:r.secretAccessKey,bucketName:r.bucketName}}},N=async(e,t,r)=>{var a;let n,i=w(r.bucketName),s=g(r.accountId),o=(a=r.bucketLabel,(n=String(a??"").trim())||String(i??"").trim()),l=String(r.accessKeyId??"").trim(),u=String(r.secretAccessKey??"").trim();if(!i)throw Error("桶名称不能为空");if(!/^[a-z0-9][a-z0-9-]{1,61}[a-z0-9]$/i.test(i))throw Error("桶名称格式不正确");if(!s)throw Error("Account ID 不能为空");if(!l)throw Error("Access Key ID 不能为空");if(!u)throw Error("Secret Access Key 不能为空");let c=await v(`user_r2_buckets?select=${_}&account_id=eq.${encodeURIComponent(s)}&bucket_name=eq.${encodeURIComponent(i)}&limit=1`,e,"校验存储桶是否已存在失败");if(c[0]?.id)return await A(e,c[0].id,{bucketLabel:r.bucketLabel,bucketName:i,accountId:s,accessKeyId:l,secretAccessKey:u,publicBaseUrl:r.publicBaseUrl,customBaseUrl:r.customBaseUrl,transferModeOverride:r.transferModeOverride,isDefault:!0===r.isDefault});let d={user_id:t,bucket_label:o,bucket_name:i,account_id:s,access_key_id_enc:await p(l),secret_access_key_enc:await p(u),public_base_url:y(r.publicBaseUrl)??null,custom_base_url:y(r.customBaseUrl)??null,transfer_mode_override:"auto"===r.transferModeOverride||"presigned"===r.transferModeOverride||"proxy"===r.transferModeOverride?r.transferModeOverride:null,is_default:!!r.isDefault},f=await (0,b.supabaseRestFetch)("user_r2_buckets",{token:e,method:"POST",body:d,prefer:"return=representation"}),m=(await (0,b.readSupabaseRestArray)(f,"新增存储桶失败"))[0];if(!m?.id)throw Error("新增存储桶失败");return d.is_default?await R(e,m.id):await S(e),E(m)},A=async(e,t,r)=>{let a={};if(void 0!==r.bucketName){let e=w(r.bucketName);if(!e)throw Error("桶名称不能为空");if(!/^[a-z0-9][a-z0-9-]{1,61}[a-z0-9]$/i.test(e))throw Error("桶名称格式不正确");a.bucket_name=e}if(void 0!==r.bucketLabel){let e=String(r.bucketLabel??"").trim();e&&(a.bucket_label=e)}if(void 0!==r.accountId){let e=g(r.accountId);if(!e)throw Error("Account ID 不能为空");a.account_id=e}if(void 0!==r.accessKeyId){let e=String(r.accessKeyId??"").trim();e&&(a.access_key_id_enc=await p(e))}if(void 0!==r.secretAccessKey){let e=String(r.secretAccessKey??"").trim();e&&(a.secret_access_key_enc=await p(e))}if(void 0!==r.publicBaseUrl&&(a.public_base_url=y(r.publicBaseUrl)??null),void 0!==r.customBaseUrl&&(a.custom_base_url=y(r.customBaseUrl)??null),void 0!==r.transferModeOverride&&(a.transfer_mode_override="auto"===r.transferModeOverride||"presigned"===r.transferModeOverride||"proxy"===r.transferModeOverride?r.transferModeOverride:null),Object.keys(a).length>0){let r=await (0,b.supabaseRestFetch)(`user_r2_buckets?id=eq.${encodeURIComponent(t)}`,{token:e,method:"PATCH",body:a,prefer:"return=representation"}),n=await (0,b.readSupabaseRestArray)(r,"更新存储桶失败");if(!n[0]?.id)throw Error("未找到存储桶")}!0===r.isDefault&&await R(e,t);let n=(await v(`user_r2_buckets?select=${_}&id=eq.${encodeURIComponent(t)}&limit=1`,e,"刷新存储桶信息失败"))[0];if(!n)throw Error("未找到存储桶");return E(n)},I=async(e,t)=>{let r=await (0,b.supabaseRestFetch)(`user_r2_buckets?id=eq.${encodeURIComponent(t)}`,{token:e,method:"DELETE",prefer:"return=minimal"});if(!r.ok)throw Error(await r.text().catch(()=>"")||"删除存储桶失败");await S(e)},O=async(e,t)=>{await R(e,t)};e.s(["createUserBucket",0,N,"deleteUserBucket",0,I,"listUserBucketViews",0,C,"resolveBucketCredentials",0,T,"setDefaultBucket",0,O,"updateUserBucket",0,A],1164)},58703,e=>{"use strict";var t=e.i(4648);let r=async(e,r=900)=>await (0,t.issueSealedPayload)(e,r),a=async(e,r)=>{let a=await (0,t.readSealedPayload)(e);if(!a||a.op!==r)throw Error("操作令牌无效，请重试。");return a};e.s(["issueRouteToken",0,r,"readRouteToken",0,a])},81377,(e,t,r)=>{self._ENTRIES||={};let a=Promise.resolve().then(()=>e.i(83800));a.catch(()=>{}),self._ENTRIES["middleware_app/api/object/route"]=new Proxy(a,{get(e,t){if("then"===t)return(t,r)=>e.then(t,r);let r=(...r)=>e.then(e=>(0,e[t])(...r));return r.then=(r,a)=>e.then(e=>e[t]).then(r,a),r}})},33285,e=>{"use strict";e.s([],82807),e.i(82807);var t=e.i(92174),r=e.i(83642);class a{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller:e,serializer:t,deserializer:r,serdeContext:a,defaultContentType:n}){this.marshaller=e,this.serializer=t,this.deserializer=r,this.serdeContext=a,this.defaultContentType=n}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:r}){let a=this.marshaller,n=t.getEventStreamMember(),i=t.getMemberSchema(n),s=this.serializer,o=this.defaultContentType,l=Symbol("initialRequestMarker"),u={async *[Symbol.asyncIterator](){if(r){s.write(t,r);let e=s.flush();yield{[l]:!0,headers:{":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:o}},body:e}}for await(let t of e)yield t}};return a.serialize(u,e=>{if(e[l])return{headers:e.headers,body:e.body};let t=Object.keys(e).find(e=>"__type"!==e)??"",{additionalHeaders:r,body:a,eventType:n,explicitPayloadContentType:s}=this.writeEventBody(t,i,e);return{headers:{":event-type":{type:"string",value:n},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:s??o},...r},body:a}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:a}){let n=this.marshaller,i=t.getEventStreamMember(),s=t.getMemberSchema(i).getMemberSchemas(),o=Symbol("initialResponseMarker"),l=n.deserialize(e.body,async e=>{let a=Object.keys(e).find(e=>"__type"!==e)??"",n=e[a].body;if("initial-response"===a){let e=await this.deserializer.read(t,n);return delete e[i],{[o]:!0,...e}}if(!(a in s))return{$unknown:e};{let t=s[a];if(t.isStructSchema()){let i={},s=!1;for(let[o,l]of t.structIterator()){let{eventHeader:t,eventPayload:u}=l.getMergedTraits();if(s=s||!!(t||u),u)l.isBlobSchema()?i[o]=n:l.isStringSchema()?i[o]=(this.serdeContext?.utf8Encoder??r.toUtf8)(n):l.isStructSchema()&&(i[o]=await this.deserializer.read(l,n));else if(t){let t=e[a].headers[o]?.value;null!=t&&(l.isNumericSchema()?t&&"object"==typeof t&&"bytes"in t?i[o]=BigInt(t.toString()):i[o]=Number(t):i[o]=t)}}if(s)return{[a]:i};if(0===n.byteLength)return{[a]:{}}}return{[a]:await this.deserializer.read(t,n)}}}),u=l[Symbol.asyncIterator](),c=await u.next();if(c.done)return l;if(c.value?.[o]){if(!t)throw Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[e,t]of Object.entries(c.value))a[e]=t}return{async *[Symbol.asyncIterator](){for(c?.value?.[o]||(yield c.value);;){let{done:e,value:t}=await u.next();if(e)break;yield t}}}}writeEventBody(e,r,a){let n,i=this.serializer,s=e,o=null,l=r.getSchema()[4].includes(e),u={};if(l){let t=r.getMemberSchema(e);if(t.isStructSchema()){for(let[r,n]of t.structIterator()){let{eventHeader:t,eventPayload:i}=n.getMergedTraits();if(i)o=r;else if(t){let t=a[e][r],i="binary";n.isNumericSchema()?i=-0x80000000<=t&&t<=0x80000000-1?"integer":"long":n.isTimestampSchema()?i="timestamp":n.isStringSchema()?i="string":n.isBooleanSchema()&&(i="boolean"),null!=t&&(u[r]={type:i,value:t},delete a[e][r])}}if(null!==o){let r=t.getMemberSchema(o);r.isBlobSchema()?n="application/octet-stream":r.isStringSchema()&&(n="text/plain"),i.write(r,a[e][o])}else i.write(t,a[e])}else throw Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{let[t,r]=a[e];s=t,i.write(15,r)}let c=i.flush();return{body:"string"==typeof c?(this.serdeContext?.utf8Decoder??t.fromUtf8)(c):c,eventType:s,explicitPayloadContentType:n,additionalHeaders:u}}}e.s(["EventStreamSerde",()=>a],2063),e.i(2063),e.s(["EventStreamSerde",()=>a],33285)},83800,e=>{"use strict";let t;var r,a=e.i(92480),n=e.i(87259),i=e.i(51615),s=e.i(73246),o=e.i(23646),l=e.i(32995),u=e.i(4842),c=e.i(68045),d=e.i(87167),p=e.i(20900),f=e.i(83877),m=e.i(64927),h=e.i(66163),b=e.i(16423),_=e.i(63402),y=e.i(40409),w=e.i(14327),g=e.i(80441);e.i(27064);var E=e.i(34277),v=e.i(51959),R=e.i(62397),S=e.i(58703),C=e.i(1164),k=e.i(12454);let T=(e,t)=>new Response(JSON.stringify(t),{status:e,headers:{"Content-Type":"application/json"}}),N=async(e,t)=>{let r=await (0,v.requireSupabaseUser)(e);return await (0,C.resolveBucketCredentials)(r.token,t)};async function A(e){try{let t,r,a,{searchParams:n}=new URL(e.url),i=n.get("token")??"",s=n.get("filename");if(i){let e=await (0,S.readRouteToken)(i,"object");t=e.creds,r=e.key,a=!!e.download}else{let i=n.get("bucket"),s=n.get("key");if(a="1"===n.get("download"),!i||!s)return T(400,{error:"请求参数不完整"});t=(await N(e,i)).creds,r=s}let o=(s||r.split("/").pop()||"download").replaceAll("\n"," ").replaceAll("\r"," ").replaceAll('"',"'").slice(0,180)||"download",l=(0,R.createR2Bucket)(t),u=null,c=e.headers.get("range");(c||a)&&(u=await l.head(r));let d=u?.size??null,p=((e,t)=>{if(!e)return null;let r=e.match(/^bytes=(\d*)-(\d*)$/i);if(!r)return null;let a=r[1],n=r[2];if(!a&&n){if(null==t)return null;let e=Number.parseInt(n,10);return!Number.isFinite(e)||e<=0?null:{start:Math.max(0,t-e),end:t-1}}let i=a?Number.parseInt(a,10):NaN;if(!Number.isFinite(i)||i<0)return null;if(!n)return null==t?null:{start:i,end:t-1};let s=Number.parseInt(n,10);return!Number.isFinite(s)||s<i?null:{start:i,end:s}})(c,d),f=new Headers;if(f.set("Cache-Control","no-store"),f.set("Accept-Ranges","bytes"),a&&f.set("Content-Disposition",`attachment; filename="${o}"`),p){let e=p.end-p.start+1,t=await l.get(r,{range:{offset:p.start,length:e}});if(!t)return new Response("Not found",{status:404});let n=t.httpMetadata?.contentType;n&&f.set("Content-Type",n),!a&&(s||"application/pdf"===n)&&f.set("Content-Disposition",`inline; filename="${o}"`),null!=d&&f.set("Content-Range",`bytes ${p.start}-${p.end}/${d}`),f.set("Content-Length",String(e));let i=t.httpEtag??t.etag;return i&&f.set("ETag",i),new Response(t.body,{status:206,headers:f})}let m=await l.get(r);if(!m)return new Response("Not found",{status:404});let h=m.httpMetadata?.contentType;h&&f.set("Content-Type",h),!a&&(s||"application/pdf"===h)&&f.set("Content-Disposition",`inline; filename="${o}"`);let b=m.size??u?.size;"number"==typeof b&&f.set("Content-Length",String(b));let _=m.httpEtag??m.etag??u?.etag;return _&&f.set("ETag",_),new Response(m.body,{status:200,headers:f})}catch(t){let e=Number(t?.status??NaN);return T(Number.isFinite(e)&&e>=100?e:500,{error:(0,k.toChineseErrorMessage)(t,"读取对象失败，请稍后重试。")})}}e.s(["GET",()=>A,"runtime",0,"edge"],97009);var I=e.i(97009);let O=new s.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/object/route",pathname:"/api/object",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/object/route.ts",nextConfigOutput:"",userland:I}),{workAsyncStorage:U,workUnitAsyncStorage:M,serverHooks:x}=O;function P(){return(0,l.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:M})}async function D(e,t,r){O.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/object/route";n=n.replace(/\/index$/,"")||"/";let s=await O.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:l,params:v,nextConfig:R,parsedUrl:S,isDraftMode:C,prerenderManifest:k,routerServerContext:T,isOnDemandRevalidate:N,revalidateOnlyGenerated:A,resolvedPathname:I,clientReferenceManifest:U,serverActionsManifest:M}=s,x=(0,d.normalizeAppPath)(n),P=!!(k.dynamicRoutes[x]||k.routes[I]),D=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,S,!1):t.end("This page could not be found"),null);if(P&&!C){let e=!!k.routes[I],t=k.dynamicRoutes[x];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await D();throw new g.NoFallbackError}}let B=null;!P||O.isDev||C||(B="/index"===(B=I)?"/":B);let $=!0===O.isDev||!P,K=P&&!$;M&&U&&(0,a.setManifestsSingleton)({page:n,clientReferenceManifest:U,serverActionsManifest:M});let j=e.method||"GET",q=(0,c.getTracer)(),z=q.getActiveScopeSpan(),H={params:v,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,u.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>O.onRequestError(e,t,a,n,T)},sharedContext:{buildId:l}},L=new p.NodeNextRequest(e),F=new p.NodeNextResponse(t),G=f.NextRequestAdapter.fromNodeNextRequest(L,(0,f.signalFromNodeResponse)(t));try{let a=async e=>O.handle(G,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${n}`)}),s=!!(0,u.getRequestMeta)(e,"minimalMode"),l=async l=>{var u,c;let d=async({previousCacheEntry:o})=>{try{if(!s&&N&&A&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(l);e.fetchMetrics=H.renderOpts.fetchMetrics;let u=H.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let c=H.renderOpts.collectedTags;if(!P)return await (0,b.sendResponse)(L,F,n,H.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,_.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[w.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,a=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:n.status,body:i.Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==o?void 0:o.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:N})},!1,T),t}},p=await O.handleResponse({req:e,nextConfig:R,cacheKey:B,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:A,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:s});if(!P)return null;if((null==p||null==(u=p.value)?void 0:u.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(c=p.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",N?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,_.fromNodeOutgoingHttpHeaders)(p.value.headers);return s&&P||f.delete(w.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,y.getCacheControlHeader)(p.cacheControl)),await (0,b.sendResponse)(L,F,new Response(p.value.body,{headers:f,status:p.value.status||200})),null};z?await l(z):await q.withPropagatedContext(e.headers,()=>q.trace(m.BaseServerSpan.handleRequest,{spanName:`${j} ${n}`,kind:c.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:N})},!1,T),P)throw t;return await (0,b.sendResponse)(L,F,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>P,"routeModule",()=>O,"serverHooks",()=>x,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>M],82600);var B=e.i(82600);let $=null==(r=self.__RSC_MANIFEST)?void 0:r["/api/object/route"],K=(t=self.__RSC_SERVER_MANIFEST)?JSON.parse(t):void 0;$&&K&&(0,a.setManifestsSingleton)({page:"/api/object/route",clientReferenceManifest:$,serverActionsManifest:K});let j=n.EdgeRouteModuleWrapper.wrap(B.routeModule,{page:"/api/object/route"});e.s(["ComponentMod",0,B,"default",0,j],83800)}]);

//# sourceMappingURL=_8f0f0429._.js.map